{{- $gaID := getenv "GA_TRACKING_ID" -}}
{{- if and (eq hugo.Environment "production") $gaID -}}
  {{- $version := .GitInfo.Hash | default (now.Unix) -}}
  {{- $opts := dict "minify" hugo.IsProduction "targetPath" "scripts/ga-init.js" -}}
  {{- with resources.Get "scripts/ga-init.js" | js.Build $opts -}}
    {{- if hugo.IsProduction -}}
      {{- with . | fingerprint -}}
<script id="ga-loader"
        src="{{ .RelPermalink }}"
        integrity="{{ .Data.Integrity }}" crossorigin="anonymous"
        defer
        data-ga-id="{{ $gaID }}"
        data-version="{{ $version }}"></script>
      {{- end -}}
    {{- else -}}
<script id="ga-loader"
        src="{{ .RelPermalink }}"
        defer
        data-ga-id="{{ $gaID }}"
        data-version="{{ $version }}"></script>
    {{- end -}}
  {{- end -}}
{{- end -}}
